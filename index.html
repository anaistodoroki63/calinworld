<body>
<script>
const sound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_4b6c1d1e61.mp3?filename=cat-meow-14536.mp3");
const hug = document.getElementById("hug");
const log = document.getElementById("log");
const cat = document.getElementById("cat");
const counter = document.getElementById("counter");

// Structure stockage:
// calins = { "Anais": { sent: 3, received: 5 }, ... }
let calins = JSON.parse(localStorage.getItem("calins")) || {};

function getUser(name) {
  if (!calins[name]) {
    calins[name] = { sent: 0, received: 0 };
  }
  return calins[name];
}

function updateStorage() {
  localStorage.setItem("calins", JSON.stringify(calins));
}

function updateCounter() {
  let txt = "";
  for (let user in calins) {
    txt += `ğŸ± ${user} â†’ envoyÃ©s: ${calins[user].sent}, reÃ§us: ${calins[user].received}<br>`;
  }
  counter.innerHTML = txt;
}

function envoyerCalin() {
  const user = document.getElementById("username").value.trim();
  const target = document.getElementById("target").value.trim();

  if (!user || !target) {
    alert("Entre les deux pseudos ğŸ¥º");
    return;
  }

  if (user === target) {
    alert("Tu peux pas te faire un cÃ¢lin Ã  toi-mÃªme ğŸ˜¹");
    return;
  }

  const fromUser = getUser(user);
  const toUser = getUser(target);

  fromUser.sent++;
  toUser.received++;
  updateStorage();
  updateCounter();

  const cats = ["ğŸ±ğŸ’—", "ğŸ˜ºâœ¨", "ğŸ±ğŸŒ¸", "ğŸ˜½ğŸ’•", "ğŸˆğŸ’–"];
  cat.textContent = cats[Math.floor(Math.random() * cats.length)];
  cat.style.display = "block";
  sound.currentTime = 0;
  sound.play();

  hug.textContent = "ğŸ¤—ğŸ’–ğŸ¤—";

  const message = document.createElement("div");
  message.textContent = `ğŸŒ¸ ${user} a fait un cÃ¢lin Ã  ${target}`;
  log.prepend(message);
}

updateCounter();
</script>
<body>
